<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <meta charset="utf-8">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
        <script src="https://hara-jp.com/js/jquery-linedtextarea.js"></script>
        <link href="https://hara-jp.com/css/jquery-linedtextarea.css" type="text/css" rel="stylesheet" />

        <script type="text/javascript">
            async function load_file(){
                var name = document.getElementById("file_name").value;
                var url ="/get_file"
                const response = await fetch(url,{
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json;charset=utf-8",
                    },
                    body: JSON.stringify({'file_name': name})
                }).catch(error =>{
                    alert("ERROR");
                    console.error('エラーが発生しました', error);
                });;

                const data = await response.json();
                console.log(data);
                document.getElementById("editarea").value=data['data'];
            }

            async function save_file(){
                var name = document.getElementById("file_name").value;
                var txt = document.getElementById("editarea").value;
                var url ="/save_file"
                const response = await fetch(url,{
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json;charset=utf-8",
                    },
                    body: JSON.stringify({'file_name': name, 'data': txt})
                }
                );
                console.log(response);
                alert("Save fiel: "+name);
            }

            function load_file_event(e){
                if (e.key == "Enter"){
                    load_file();
                }
            }

            function init(){
                const fname_form = document.getElementById('file_name');
                fname_form.addEventListener("keydown", load_file_event);
            }
        </script>
        <title>Edit file</title>
    </head>
    <body onLoad="init()">
        Filename:  <input type="text" id="file_name" />
        <input type="button" onClick="load_file()" value="Load" style="font-size:12pt;width:100px;">
        <input type="button" onClick="save_file()" value="Save" style="font-size:12pt;width:100px;">
        <hr>
        <textarea id="editarea" name="info" class="lined" style="font-size:12pt;width:90%;height:500px;line-height:1.5em"></textarea>
        <script>
            $(function() {
                $(".lined").linedtextarea();
            });
        </script>
    </body>
</html>